!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@joskii/jflow-core")):"function"==typeof define&&define.amd?define(["exports","@joskii/jflow-core"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self)["jflow-vue2-plugin"]={},e.JFlowInstance$1)}(this,(function(e,n){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function o(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var o=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,o.get?o:{enumerable:!0,get:function(){return e[t]}})}})),n.default=e,Object.freeze(n)}var r=t(n),i=o(n);function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){u(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_(o.key),o)}}function u(e,n,t){return(n=_(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function l(e,n){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,n){return e.__proto__=n,e},l(e,n)}function d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function h(e,n,t){return h=d()?Reflect.construct.bind():function(e,n,t){var o=[null];o.push.apply(o,n);var r=new(Function.bind.apply(e,o));return t&&l(r,t.prototype),r},h.apply(null,arguments)}function p(e){var n="function"==typeof Map?new Map:void 0;return p=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,o)}function o(){return h(e,arguments,f(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),l(o,e)},p(e)}function m(e,n){if(n&&("object"==typeof n||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function v(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var o,r,i,c,s=[],a=!0,u=!1;try{if(i=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;a=!1}else for(;!(a=(o=i.call(t)).done)&&(s.push(o.value),s.length!==n);a=!0);}catch(e){u=!0,r=e}finally{try{if(!a&&null!=t.return&&(c=t.return(),Object(c)!==c))return}finally{if(u)throw r}}return s}}(e,n)||j(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e){return function(e){if(Array.isArray(e))return w(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||j(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,n){if(e){if("string"==typeof e)return w(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?w(e,n):void 0}}function w(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=new Array(n);t<n;t++)o[t]=e[t];return o}function _(e){var n=function(e,n){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,n||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:String(n)}var b={provide:function(){return{addToStack:this.addToStack,removeFromStack:this.removeFromStack}},data:function(){return{stack:[]}},methods:{addToStack:function(e,n){this._jflowInstance.addToStack(e),n&&e._jflow.setRenderNodeBySource(n,e)},removeFromStack:function(e){this._jflowInstance.removeFromStack(e)},onStackChangeHandler:function(){this._jflowInstance.recalculate(),this._jflowInstance.reflow()}}},g={mixins:[b],provide:function(){return{renderJFlow:this.renderJFlow,getJFlow:this.getInstance,addToLinkStack:this.addToLinkStack,removeFromLinkStack:this.removeFromLinkStack}},props:{configs:{type:Object,default:function(){return{}}},loading:Boolean,genVueComponentKey:{type:Function}},data:function(){return{renderNodes:[],renderLinks:[]}},render:function(e){var n=this;if(this.renderNodes.length){var t=this.renderNodes.map((function(e){var t=e.type,o=e.source,r=e.layoutNode;if(!n.$scopedSlots[t]){if(!n.$scopedSlots.jflowcommon)return null;t="jflowcommon"}if(r.__vnode__)return r.__vnode__;var i=v(n.$scopedSlots[t]({source:o,layoutNode:r}),1)[0];return n.genVueComponentKey&&(i.key=n.genVueComponentKey(o)),r.__vnode__=i,i})).filter((function(e){return!!e})),o=this.renderLinks.map((function(e){var t=e.type||"plainlink";if(!n.$scopedSlots[t])return null;if(e.__vnode__)return e.__vnode__;var o=v(n.$scopedSlots[t]({configs:e}),1)[0];if(n.genVueComponentKey){var r=n.genVueComponentKey(e.from.source),i=n.genVueComponentKey(e.to.source),c=e.part;o.key="".concat(r,"-").concat(i,"-").concat(c)}return e.__vnode__=o,o}));return e("div",[].concat(y(t),y(o)))}return e("div",this.$slots.default)},created:function(){this._jflowInstance=new r.default(this.configs),this.$emit("update:loading",!0),this.genNodeLinkMeta(),this.syncNodeLink()},mounted:function(){this.mountJFlow()},beforeDestroy:function(){var e;null===(e=this._jflowInstance)||void 0===e||e.destroy()},methods:{mountJFlow:function(){var e=this;this._jflowInstance.$mount(this.$el),Object.keys(this.$listeners).map((function(n){var t=e.$listeners[n].bind(e);e._jflowInstance.addEventListener(n,t)})),this.$emit("update:loading",!1)},genNodeLinkMeta:function(){var e=this;this.nodes=this._jflowInstance._layout.flowStack.map((function(n){n.type;var t=n.layoutNode,o=n.source,r=e._jflowInstance.source_Layout_Render_NodeMap;return(r.has(o)?r.get(o):r.set(o)).layoutNode=t,n})),this.links=this._jflowInstance._layout.flowLinkStack.slice()},syncNodeLink:function(){this.renderNodes=this.nodes.slice(),this.renderLinks=this.links.slice()},reflow:function(e,n){var t=this;this.genNodeLinkMeta(),this.syncNodeLink(),this.$nextTick((function(){e&&e(),t._jflowInstance.recalculate(),t._jflowInstance.scheduleRender((function(){n&&n()}))}))},getInstance:function(){return this._jflowInstance},renderJFlow:function(){var e=this;this.__renderInSchedule__||(this.__renderInSchedule__=!0,this.$nextTick((function(){e._jflowInstance._render(),e.__renderInSchedule__=!1})))},addToLinkStack:function(e,n,t){this._jflowInstance.addToLinkStack(e),n&&t&&e._jflow.addLinkNodeBySource(n,t,e)},removeFromLinkStack:function(e,n,t){this._jflowInstance.removeFromLinkStack(e),n&&t&&e._jflow.removeLinkNodeBySource(n,t,e)}}};function k(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function I(){return S(null,[].slice.call(arguments,0))}function S(e,n){for(var t,o,r,i,c,s=n.length,a=n[0],u={},f=e&&e.equal||O,l=1;l<s;l++)for(t=n[l],r=(o=Object.keys(t)).length,c=0;c<r;c++)f(t[i=o[c]],a[i])||(u[i]=t[i]);return u}function O(e,n){return e===n}I.custom=function(e){return S(e,[].slice.call(arguments,1))};var L=k(I);function E(e){var n="string"==typeof e?i[e]:e;return{inject:["addToStack","removeFromStack"],props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},source:{type:Object}},watch:{configs:function(e,n){var t=L(e,n);0!==Object.keys(t).length&&this._jflowInstance.setConfig(e)},$listeners:function(e,n){var t=this,o=[],r=[],i=Object.keys(e).map((function(n){return{event:n,handler:e[n]}})),c=Object.keys(n).map((function(e){return{event:e,handler:n[e]}}));i.forEach((function(e){var n=e.handler;c.find((function(e){return e.handler===n}))||o.push(e)})),c.forEach((function(e){var n=e.handler;i.find((function(e){return e.handler===n}))||r.push(e)})),o.forEach((function(e){t._jflowInstance.addEventListener(e.event,e.handler)})),r.forEach((function(e){t._jflowInstance.removeEventListener(e.event,e.handler)}))},visible:function(e){this._jflowInstance.visible=e},source:function(e){this._jflowInstance._jflow.setRenderNodeBySource(e,this._jflowInstance)}},render:function(e){return null},created:function(){this._jflowInstance=new n(this.configs),this._jflowInstance.visible=this.visible,this.bindListeners(),this.addToStack(this._jflowInstance,this.source)},destroyed:function(){this._jflowInstance.destroy(),this.removeFromStack(this._jflowInstance)},methods:{bindListeners:function(){var e=this;Object.keys(this.$listeners).map((function(n){var t=e.$listeners[n];e._jflowInstance.addEventListener(n,t)}))}}}}function F(e){var n="string"==typeof e?i[e]:e;return{inject:["addToLinkStack","removeFromLinkStack","getJFlow"],props:{configs:{type:Object,default:function(){return{}}},from:Object,to:Object},render:function(e){return null},created:function(){var e=this.getJFlow(),n=e.getRenderNodeBySource(this.from),t=e.getRenderNodeBySource(this.to);this.createInstance(n,t)},mounted:function(){var e=this;this.unwatch=this.$watch((function(){return[e.from,e.to,e.configs]}),(function(){e.refreshConfig()}))},methods:{createInstance:function(e,t){e&&t&&(this._jflowInstance=new n(s(s({},this.configs),{},{from:e,to:t})),this.bindListeners(),this.addToLinkStack(this._jflowInstance,this.from,this.to))},refreshConfig:function(){var e=this.getJFlow(),n=e.getRenderNodeBySource(this.from),t=e.getRenderNodeBySource(this.to);this._jflowInstance?this._jflowInstance.setConfig(s(s({},this.configs),{},{from:n,to:t})):this.createInstance(n,t)},bindListeners:function(){var e=this;Object.keys(this.$listeners).map((function(n){var t=e.$listeners[n];e._jflowInstance.addEventListener(n,t)}))}},destroyed:function(){this.unwatch(),this._jflowInstance&&this.removeFromLinkStack(this._jflowInstance,this.from,this.to)}}}function T(e){var n="string"==typeof e?i[e]:e;return{mixins:[b],inject:{addToBelongStack:{from:"addToStack"},removeFromBelongStack:{from:"removeFromStack"},renderJFlow:{from:"renderJFlow"}},render:function(e){return e("jflow-group",this.$slots.default)},props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},source:{type:Object}},watch:{configs:function(e,n){JSON.stringify(e)!==JSON.stringify(n)&&this._jflowInstance.setConfig(e)},$listeners:function(e,n){var t=this,o=[],r=[],i=Object.keys(e).map((function(n){return{event:n,handler:e[n]}})),c=Object.keys(n).map((function(e){return{event:e,handler:n[e]}}));i.forEach((function(e){var n=e.handler;c.find((function(e){return e.handler===n}))||o.push(e)})),c.forEach((function(e){var n=e.handler;i.find((function(e){return e.handler===n}))||r.push(e)})),o.forEach((function(e){t._jflowInstance.addEventListener(e.event,e.handler)})),r.forEach((function(e){t._jflowInstance.removeEventListener(e.event,e.handler)}))},visible:function(e){this._jflowInstance.visible=e},source:function(e){this._jflowInstance._jflow.setRenderNodeBySource(e,this._jflowInstance)}},created:function(){var e=this;this._jflowInstance=new n(this.configs),this._jflowInstance.visible=this.visible,Object.keys(this.$listeners).map((function(n){var t=e.$listeners[n].bind(e);e._jflowInstance.addEventListener(n,t)})),this.addToBelongStack(this._jflowInstance,this.source)},mounted:function(){this._jflowInstance.recalculate()},updated:function(){this._jflowInstance.recalculateUp()},destroyed:function(){this._jflowInstance.destroy(),this.removeFromBelongStack(this._jflowInstance)}}}var $={mixins:[b],inject:{addToBelongStack:{from:"addToStack"},removeFromBelongStack:{from:"removeFromStack"},renderJFlow:{from:"renderJFlow"}},data:function(){return{nodes:[]}},props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},source:{type:Object},genVueComponentKey:{type:Function}},watch:{configs:function(e,n){JSON.stringify(e)!==JSON.stringify(n)&&this._jflowInstance.setConfig(e)},$listeners:function(e,n){var t=this,o=[],r=[],i=Object.keys(e).map((function(n){return{event:n,handler:e[n]}})),c=Object.keys(n).map((function(e){return{event:e,handler:n[e]}}));i.forEach((function(e){var n=e.handler;c.find((function(e){return e.handler===n}))||o.push(e)})),c.forEach((function(e){var n=e.handler;i.find((function(e){return e.handler===n}))||r.push(e)})),o.forEach((function(e){t._jflowInstance.addEventListener(e.event,e.handler)})),r.forEach((function(e){t._jflowInstance.removeEventListener(e.event,e.handler)}))},visible:function(e){this._jflowInstance.visible=e},source:function(e){this._jflowInstance._jflow.setRenderNodeBySource(e,this._jflowInstance)}},created:function(){var e=this;this._jflowInstance=new n.TextGroup(this.configs),this._jflowInstance.visible=this.visible,Object.keys(this.$listeners).map((function(n){var t=e.$listeners[n].bind(e);e._jflowInstance.addEventListener(n,t)})),this.addToBelongStack(this._jflowInstance,this.source),this.genTextElementMeta()},mounted:function(){this._jflowInstance.recalculate()},updated:function(){this._jflowInstance.recalculateUp()},destroyed:function(){this._jflowInstance.destroy(),this.removeFromBelongStack(this._jflowInstance)},render:function(e){var n=this;return this.nodes.length?e("div",this.nodes.map((function(e){var t=e.type,o=e.source;if(!n.$scopedSlots[t]){if(!n.$scopedSlots.jflowcommon)return;t="jflowcommon"}if(e.__vnode__)return e.__vnode__;var r=v(n.$scopedSlots[t]({source:o,textElement:e}),1)[0];return n.genVueComponentKey&&(r.key=n.genVueComponentKey(o)),e.__vnode__=r,r}))):e("jflow-group",this.$slots.default)},methods:{genTextElementMeta:function(){this.nodes=this._jflowInstance._flattenTxtElem.filter((function(e){return"text"!==e.type}))},reflow:function(){var e=this;this._jflowInstance.refreshTextElements(),this.genTextElementMeta(),this.$nextTick((function(){e._jflowInstance.refresh()}))}}};var N=[{name:"Jflow",component:g},{name:"Group",component:T("Group")}].concat(y(["CapsuleGroup","CapsuleVerticalGroup","DiamondGroup","DiamondVerticalGroup","RhombusGroup","PointGroup","ScrollGroup"].map((function(e){return{name:e,component:T(e)}}))),y(["Point","Rectangle","Capsule","Diamond","Rhombus","Text","Icon","ShadowDom","TextEditor"].map((function(e){return{name:e,component:E(e)}}))),y(["Link","PolyLink","BezierLink"].map((function(e){return{name:e,component:F(e)}}))),[{name:"TextGroup",component:$}]);customElements.define("jflow-group",function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&l(e,n)}(s,e);var n,t,o,r,i,c=(n=s,t=d(),function(){var e,o=f(n);if(t){var r=f(this).constructor;e=Reflect.construct(o,arguments,r)}else e=o.apply(this,arguments);return m(this,e)});function s(){var e;return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,s),(e=c.call(this)).attachShadow({mode:"open"}),e}return o=s,r&&a(o.prototype,r),i&&a(o,i),Object.defineProperty(o,"prototype",{writable:!1}),o}(p(HTMLElement)));var B={install:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="j";n&&n.prefix&&(t=n.prefix),N.forEach((function(n){e.component("".concat(t).concat(n.name),n.component)})),n.customInstance&&Object.keys(n.customInstance).forEach((function(o){e.component("".concat(t).concat(o),E(n.customInstance[o]))})),n.customGroups&&Object.keys(n.customGroups).forEach((function(o){e.component("".concat(t).concat(o),T(n.customGroups[o]))})),n.customLink&&Object.keys(n.customLink).forEach((function(o){e.component("".concat(t).concat(o),F(n.customLink[o]))}))}};e.JFlowLinkGroup=function(e){return{mixins:[b],inject:{addToBelongStack:{from:"addToStack"},removeFromBelongStack:{from:"removeFromStack"},renderJFlow:{from:"renderJFlow"}},render:function(e){var n=this,t=this.renderLinks.map((function(e){var t=e.type||"plainlink";if(!n.$scopedSlots[t])return null;if(e.__vnode__)return e.__vnode__;var o=v(n.$scopedSlots[t]({configs:e}),1)[0];if(n.genVueComponentKey){var r=n.genVueComponentKey(e.from.source),i=n.genVueComponentKey(e.to.source),c=e.part;o.key="".concat(r,"-").concat(i,"-").concat(c)}return e.__vnode__=o,o}));return e("jflow-group",[].concat(y(this.$slots.default),y(t)))},props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},source:{type:Object}},data:function(){return{renderLinks:[]}},watch:{configs:function(e,n){JSON.stringify(e)!==JSON.stringify(n)&&this._jflowInstance.setConfig(e)},$listeners:function(e,n){var t=this,o=[],r=[],i=Object.keys(e).map((function(n){return{event:n,handler:e[n]}})),c=Object.keys(n).map((function(e){return{event:e,handler:n[e]}}));i.forEach((function(e){var n=e.handler;c.find((function(e){return e.handler===n}))||o.push(e)})),c.forEach((function(e){var n=e.handler;i.find((function(e){return e.handler===n}))||r.push(e)})),o.forEach((function(e){t._jflowInstance.addEventListener(e.event,e.handler)})),r.forEach((function(e){t._jflowInstance.removeEventListener(e.event,e.handler)}))},visible:function(e){this._jflowInstance.visible=e},source:function(e){this._jflowInstance._jflow.setRenderNodeBySource(e,this._jflowInstance)}},created:function(){var n=this;this._jflowInstance=new e(this.configs),this._jflowInstance.visible=this.visible,Object.keys(this.$listeners).map((function(e){var t=n.$listeners[e].bind(n);n._jflowInstance.addEventListener(e,t)})),this.addToBelongStack(this._jflowInstance,this.source),this.genLinks()},mounted:function(){this._jflowInstance.recalculate()},updated:function(){this._jflowInstance.recalculateUp()},destroyed:function(){this._jflowInstance.destroy(),this.removeFromBelongStack(this._jflowInstance)},methods:{genLinks:function(){this.renderLinks=this._jflowInstance._layout.flowLinkStack.slice()}}}},e.JFlowVuePlugin=B,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=jflow-vue2-plugin.min.js.map
